#!/bin/bash

##############################################################################
# COFFEE: Unix utilities I use way too much
# https://github.com/markuskimius/coffee
#
# Copyright (c)2020 Mark K. Kim
# Released under the Apache license 2.0
# https://github.com/markuskimius/coffee/blob/master/LICENSE
##############################################################################

function usage() {
    cat <<EOF
Output the first line in stdin then pass the rest to PROGRAM.

Usage: ${SCRIPTNAME} PROGRAM [ARGS]

  ARGS                  Arguments to PROGRAM.

Examples:

  # Top 5 connections with the largest send queue sizes
  netstat -tunapl 2>/dev/null | tail -n+2 | ${SCRIPTNAME} sort -nrk3 | head -6

Credits:
  Adapted from https://unix.stackexchange.com/questions/11859

EOF
}


##############################################################################
# PROGRAM BEGINS HERE

SCRIPTNAME=$(basename "${BASH_SOURCE}")


function main() {
    if [[ "$1" == "-h" || "$1" == "--help" ]]; then
        usage && exit 0
    fi

    body "$@"
}


function body() {
    local first

    IFS= read -r first
    printf "%s\n" "$first"

    "$@"
}


##############################################################################
# ENTRY POINT

main "$@"
